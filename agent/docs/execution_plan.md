# 銀行取引最適化ワークフロー 実行計画書

## 実行可能タスクリスト

### Phase 1: 基盤実装 (週1-2)

#### 1.1 データ基盤構築
- [ ] **Task 1**: CSV スキーマ定義 (`schemas.py`)
  - BankMaster, FeeRow, BalanceSnapshot, CashflowRow dataclass 作成
  - 型ヒント完備、__all__ 定義
  - 推定工数: 2時間

- [ ] **Task 2**: データロード機能 (`data_load.py`)
  - CSV読込関数 4つ (bank_master, fee_table, balance, cashflow)
  - データ型強制、欠損列検証
  - 推定工数: 4時間

- [ ] **Task 3**: Safety Stock計算 (`safety.py`)
  - calc_safety関数実装 (分位数ベース)
  - モンテカルロシミュレーション対応
  - 推定工数: 6時間

#### 1.2 手数料・最適化エンジン
- [ ] **Task 4**: 手数料計算ユーティリティ (`fee.py`)
  - FeeCalculator クラス実装
  - 金額帯別手数料ルックアップ
  - 推定工数: 4時間

- [ ] **Task 5**: MILP最適化モデル (`optimise.py`)
  - PuLP/CBC ベース最適化実装
  - 変数定義: x(移動額), B(残高)
  - 制約: 残高更新式, 非負制約
  - 推定工数: 12時間

### Phase 2: I/O・可視化 (週3)

- [ ] **Task 6**: 結果エクスポート (`export.py`)
  - transfer_plan.csv 出力機能
  - 実行日, 移動元/先, サービス, 金額, 手数料
  - 推定工数: 3時間

- [ ] **Task 7**: 可視化・レポート (`charts.py`)
  - コスト比較チャート (Matplotlib)
  - ベースライン vs 最適化後
  - 推定工数: 4時間

### Phase 3: UI・テスト (週4)

- [ ] **Task 8**: パラメータUI
  - ipywidgets スライダー (horizon, quantile, λ)
  - リアルタイム再計算機能
  - 推定工数: 6時間

- [ ] **Task 9**: 単体テスト
  - calc_safety エッジケーステスト
  - FeeCalculator 境界値テスト
  - 推定工数: 4時間

- [ ] **Task 10**: ドキュメント整備
  - README 作成 (セットアップ・使用方法)
  - API ドキュメント
  - 推定工数: 3時間

## Phase 4: v0.2 拡張機能

### 4.1 監視・ロギング強化
- [ ] **Task 11**: 実行時間監視 (`monitor.py`)
  - Timer コンテキストマネージャ
  - timed_run ユーティリティ関数
  - 推定工数: 3時間

- [ ] **Task 12**: KPI ロギング (`kpi_logger.py`)
  - KPIRecord dataclass 定義
  - JSON Lines 形式永続化
  - 過去データ読込・フィルタ機能
  - 推定工数: 4時間

### 4.2 制約・精度向上
- [ ] **Task 13**: Cut-off時刻制約
  - 営業時間制約をMILPに追加
  - バイナリ変数による当日/翌日振分
  - 推定工数: 8時間

- [ ] **Task 14**: 支店別対応・自己取引除外
  - branch_id ディメンション追加
  - 同一銀行・支店間取引禁止
  - 手数料ルックアップ拡張
  - 推定工数: 6時間

### 4.3 CLI・デプロイ対応
- [ ] **Task 15**: CLI インターフェース
  - 15-a: パッケージ初期化
  - 15-b: CLI骨格 (argparse)
  - 15-c: パイプライン統合
  - 15-d: Poetry スクリプト定義
  - 15-e: End-to-End テスト
  - 15-f: README更新
  - 推定工数: 10時間

## 品質保証・テスト戦略

### 自動テスト項目
1. **単体テスト**: 各モジュールの境界値・エラーケース
2. **統合テスト**: CSV読込→最適化→出力の全体フロー
3. **パフォーマンステスト**: 1,000行規模で30秒以内
4. **バックテスト**: 過去6ヶ月実データでKPI検証

### 手動テスト項目
1. **ユーザビリティテスト**: 財務担当者による操作確認
2. **精度検証**: 手動計算結果との差異確認
3. **エラーハンドリング**: 不正CSV・欠損データ対応

## リスク管理・依存関係

### 技術的リスク
| リスク | 影響度 | 対策 |
|--------|--------|------|
| MILP計算時間超過 | 高 | サービス削減・金額帯集約・Gurobi評価 |
| メモリ不足 | 中 | チャンク処理・データ型最適化 |
| 数値精度問題 | 中 | Decimal型使用・丸め誤差対策 |

### 外部依存関係
- PuLP/CBC ソルバー: 事前検証必須
- Pandas データ処理: メモリ使用量監視
- Matplotlib 可視化: 出力フォーマット確認

## ブランチ戦略・マージルール

```
main (production-ready)
├─ dev (integration branch)
   ├─ feature/task-01-schemas
   ├─ feature/task-02-dataload
   ├─ feature/task-03-safety
   └─ ...
```

### PR要件
- [ ] 全テスト通過 (pytest + mypy)
- [ ] コードレビュー承認
- [ ] 機能デモ実施
- [ ] ドキュメント更新

## KPI・完了判定基準

### v0.1 完了基準
- [ ] 振込不能件数: 0/月 (バックテスト)
- [ ] 実行時間: ≤30秒 (1,000行規模)
- [ ] コスト削減: ≥10% (手数料+機会費用)

### v0.2 完了基準
- [ ] GUI応答: ≤3秒 (パラメータ変更)
- [ ] KPIログ: 毎実行自動生成
- [ ] Cut-off制約: 違反件数 0

---

**実行責任者**: 財務企画チーム
**技術レビュー**: システム開発部
**最終承認**: 部長承認

© 2025 Mizuho Digital Planning Team